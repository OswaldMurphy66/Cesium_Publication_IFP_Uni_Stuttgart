<!DOCTYPE html>
<html lang="en">

<head>
<!-- text of browser's title/tab -->
<title>Intergrated fieldwork Demo</title>
<!-- icon displayed in the address bar -->
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Include the CesiumJS JavaScript and CSS files -->
<script src="https://cesium.com/downloads/cesiumjs/releases/1.78/Build/Cesium/Cesium.js"></script>
<link href="https://cesium.com/downloads/cesiumjs/releases/1.78/Build/Cesium/Widgets/widgets.css" rel="stylesheet">

<!-- design of the website -->
<!-- CSS used here -->
<style>
<!-- Activation of Visual tools in Cesium -->
@import url(./Cesium/Widgets/widgets.css)

*{
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
}

/* Style the header */
header {
  background-color: #666;
  height: 150px;
  padding: 5px;
  text-align: center;
  font-size: 20px;
  color: white;
}

article {
  float: left;
  padding: 20px;
  width: 65%;
  background-color: #ccc;

}

nav {
  float: right;
  width: 25%;
  background: #f1f1f1;
  padding: 20px;
  display: inline-block;
}

/* Clear floats after the columns */
section::after {
  content: "";
  display: table;
  clear: both;
}

/* Style the footer */
footer {
  background-color: #777;
  padding: 10px;
  text-align: center;
  color: white;
}

/* Style: button */
.button{
  background-color: white;
  border-radius: 5px;
  border: 1.5px solid #000;
  box-shadow: 0 5px 12px 0 rgba(0,0,0,0.3), 0 6px 20px 0 rgba(0,0,0,0.25);
  color: black;
  height: 18px;
  position: absolute;
  font-size: 14px;
  line-height: 0.7;
}

.button:hover{
  background-color: #ccc;
}

.button:active{
  background-color: white;
  transform: translateY(2px);
}

.button:focus{
  background-color: #706e6e;
  cursor: wait;
}

.button:visited{
  background-color: #706e6e;
}

/* Style: checkbox */
input[type="checkbox"] {
  position: absolute;
  left: -20px;
}

input[type="checkbox"] + label {
  position: relative;
  display: inline-flex;
  cursor: pointer;
  font-family: sans-serif;
  font-size: 16px;
  line-height: 1.3;
}

input[type="checkbox"] + label:before {
  width: 35px;
  height: 13px;
  border-radius: 30px;
  border: 2px solid #ddd;
  background-color: #EEE;
  content: "";
  margin-right: 10px;
  transition: background-color 0.5s linear;
}

input[type="checkbox"] + label:after {
  width: 13px;
  height: 13px;
  border-radius: 30px;
  background-color: #fff;
  content: "";
  transition: margin 0.1s linear;
  box-shadow: 0px 0px 5px #aaa;
  position: absolute;
  left: 3px;
  top: 3px;
}

input[type="checkbox"]:checked + label:before {
  background-color: #2b8718;
}

input[type="checkbox"]:checked + label:after {
  margin: 0 0 0 22px;
}

</style>
</head>



<!-- main content of the website -->
<body>
    <header>
      <h1> Visualization of Stadtmitte Campus <br> </h1>
    </header>

<section>
    <!-- checkboxes/buttons -->
    <nav>
        <b>3D Point Clouds</b>
        <br>
        <br>
          <input type="checkbox" id="pc1_button" onclick="Check_PC1()" checked="true"> <label for="pc1_button"> Demo for Uni Stuttgart </label>
          <button class="button" id="zoom_pc1" style="position: absolute; right: 20px;" onclick="zoompc1()" > Zoom </button>
        <br>
        <br>
          <input type="checkbox" id="pc2_button" onclick="Check_PC2()" > <label for="pc2_button"> Demo indoor </label>
          <button class="button" id="zoom_pc2" style="position: absolute; right: 20px;" onclick="zoompc2()" > Zoom </button>
        <br>
        <br>
          <input type="checkbox" id="pc3_button" onclick="Check_PC3()"> <label for="pc3_button"> Demo playgronud </label>
          <button class="button" id="zoom_pc3" style="position: absolute; right: 20px;" onclick="zoompc3()" > Zoom </button>
        <br>
        <br>
        <br>
          <b>Orthophotos</b>
        <br>
        <br>
          <input type="checkbox" id="ortho1_button" onclick="Check_OP1()" > <label for="ortho1_button"> Airport brief</label>
          <button class="button" id="zoom_ortho1" style="position: absolute; right: 20px;" onclick="zoomortho1()" > Zoom </button>
        <br>
        <br>
          <b>Polygon</b>
        <br>
        <br>
          <input type="checkbox" id="Runway_button" onclick="Check_RW()" > <label for="Runway_button"> Anflugblatt </label>
          <button class="button" id="zoom_Runway" style="position: absolute; right: 20px;" onclick="zoomRunway()" > Zoom </button>
        <br>      
        <br>
        <br>
        <b>NOTE: </b>Loading the trajectories takes a few moments.
      <br>
      <br>
    </nav>


    <!-- Cesium Viewer -->
    <article>
        <div id="cesiumContainer" style="width: 100%; height:600px"></div>
    
        <script>
            //default access token from my ion account
            Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxMjJlMDA0Zi01MjczLTQ3MjAtYTEyYS1mNWY3NjI0NDgxMzYiLCJpZCI6OTQzNTgsImlhdCI6MTY1MjkwMDIxN30.Irz7lx9hf8nDgJtHCD_2XXzNOY2giijRxZdNqLjD7HU';

            // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
            var viewer = new Cesium.Viewer('cesiumContainer', {
                geocoder: true,                
                sceneModePicker: true,         
                navigationHelpButton: true,    
                baseLayerPicker: true,         
                homeButton: true,            
                fullscreenButton: true,         
                timeline: true,                 
                animation: true,               
              terrainProvider: new Cesium.CesiumTerrainProvider({
                  url: Cesium.IonResource.fromAssetId(1),
              }),
              // terrainProvider: new Cesium.CesiumTerrainProvider({
              //   url: Cesium.IonResource.fromAssetId(1121911),
              // }),//load local terrain --- ???need to be corrected
              imageryProvider: Cesium.createWorldImagery({
                style: Cesium.IonWorldImageryStyle.AERIAL
              })


            });
             // Load Cesium World Terrain
            viewer.terrainProvider = Cesium.createWorldTerrain({
              requestWaterMask : true, // required for water effects
              requestVertexNormals : true // required for terrain lighting
            });
             // Enable depth testing so things behind the terrain disappear.
            viewer.scene.globe.depthTestAgainstTerrain = false;

			
            //add point cloud
            var pc_demo1 = viewer.scene.primitives.add(
              new Cesium.Cesium3DTileset({
                url: Cesium.IonResource.fromAssetId(1056684),
              })
            );

            var pc_demo2 = viewer.scene.primitives.add(
              new Cesium.Cesium3DTileset({
                url: Cesium.IonResource.fromAssetId(1113299),
              })
            );

            var pc_demo3 = viewer.scene.primitives.add(
              new Cesium.Cesium3DTileset({
                url: Cesium.IonResource.fromAssetId(1113301),
              })
            );


            //add orthophotos
            var ortho_demo1 = viewer.imageryLayers.addImageryProvider(
              new Cesium.IonImageryProvider({ assetId: 1113345 })
            );

            // Load KML files
            var Markings_Fixed_Point = Cesium.IonResource.fromAssetId(1137102).then(function (resource) {
                var options = {
                    camera: viewer.scene.camera,
                    canvas: viewer.scene.canvas
                };
                viewer.dataSources.add(Cesium.KmlDataSource.load(resource, options));
            });
            
            // Add Geojsons 
            Cesium.GeoJsonDataSource.clampToGround = true;

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Avoid_Urban_Area.geojson', {
            stroke: Cesium.Color.HOTPINK,
            fill: Cesium.Color.PINK.withAlpha(0.5),
            strokeWidth: 800
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Avoid_Traffic.geojson', {
            stroke: Cesium.Color.HOTPINK,
            fill: Cesium.Color.PINK.withAlpha(0.5),
            strokeWidth: 800
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Landing_Area_1.geojson', {
            stroke: Cesium.Color.DARKGREEN,
            fill: Cesium.Color.CHARTREUSE.withAlpha(0.5),
            strokeWidth: 400
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Landing_Area_2.geojson', {
            stroke: Cesium.Color.DARKGREEN,
            fill: Cesium.Color.CHARTREUSE.withAlpha(0.5),
            strokeWidth: 400
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Go_Around_Course_1.geojson', {
            stroke: Cesium.Color.YELLOW,
            fill: Cesium.Color.YELLOW.withAlpha(0.0),
            strokeWidth: 400
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Go_Around_Course_2.geojson', {
            stroke: Cesium.Color.YELLOW,
            fill: Cesium.Color.YELLOW.withAlpha(0.0),
            strokeWidth: 400
            }));

            // Adding Billboards
            var enetity = viewer.entities.add({
                name: 'Icon',
                position: Cesium.Cartesian3.fromDegrees(9.39703519151607, 48.529622848194435,1000),
                billboard: {
                    image: 'img_2022/Test_Icon.png',
                    horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    width: 20, // default: undefined
                    height: 20, // default: undefined
                    scale: 1,
                }
            })
    
            // draw rectangle---???need tobe corrected
            //var avoid2 = viewer.entities.add({
            //  name: "Avoid - traffic pattern EDSG",//Garbenstetten flugplatz
            //  rectangle: {
            //    coordinates: Cesium.Rectangle.fromDegrees(9.412508650053288,48.54343667939448, 9.43358457143229,48.54759972339579),
            //    material: Cesium.Color.RED.withAlpha(0.5),
            //    Rotation: Cesium.Math.toRadians(50),//---???
            //  },
            //});
            //avoid2.position=Cesium.Cartesian3.fromDegrees(9.412508650053288,48.54343667939448);
            ////avoid2.style.borderRadius = "25px";//---???


            //draw line
            var Segelflug = viewer.entities.add({
              name: "Segelflug - 2970ft/900m",
              wall :{
                positions : Cesium.Cartesian3.fromDegreesArray(
                  [9.39703519151607,48.529622848194435, 
                   9.386956349001773,48.530292490420834,
                   9.388908997194635,48.53648757756843,
                   9.407899037160616,48.53512358676029,
                   9.406954502423504,48.528754432235466,
                   9.402340033389647,48.529216576652004]),
                maximumHeights: [900,900,900,900,900,900],
                minumumHeights: [0,0,0,0,0,0],
                material: Cesium.Color.BLUE.withAlpha(0.5),
              },
            });

            var Motorflug = viewer.entities.add({
              name: "Motorflug - 3200ft/975m",
              wall :{
                positions : Cesium.Cartesian3.fromDegreesArray(
                  [9.39703519151607,48.529622848194435, 
                   9.37824396517381,48.53135453585247, 
                   9.379830468769919,48.54176894670979,
                   9.42008506241363,48.538955968904105,
                   9.418325533250623, 48.52821407020955,
                   9.402340033389647,48.529216576652004]),
                maximumHeights: [975,975,975,975,975,975],
                minumumHeights: [0,0,0,0,0,0],
                material: Cesium.Color.BLUE.withAlpha(0.5),
              },
            });


            //function for checkbox buttom
            function Check_PC1(){
              //Show/hide point cloud for demo
              if (document.getElementById('pc1_button').checked == true) { //if the buttons is checked
                pc_demo1.show = true;// make the point cloud visible
              }
              else {
                pc_demo1.show = false;// close the point cloud
              }
            }

            function Check_PC2(){
              //Show/hide point cloud for demo
              if (document.getElementById('pc2_button').checked == true) { //if the buttons is checked
                pc_demo2.show = true;// make the point cloud visible
              }
              else {
                pc_demo2.show = false;// close the point cloud
              }
            }

            function Check_PC3(){
              //Show/hide point cloud for demo
              if (document.getElementById('pc3_button').checked == true) { //if the buttons is checked
                pc_demo3.show = true;// make the point cloud visible
              }
              else {
                pc_demo3.show = false;// close the point cloud
              }
            }

            function Check_OP1(){
              //Show/hide point cloud for demo
              if (document.getElementById('ortho1_button').checked == true) { //if the buttons is checked
                ortho_demo1.show = true;// make the point cloud visible
              }
              else {
                ortho_demo1.show = false;// close the point cloud
              }
            }



            //function for zoom buttom
            function zoompc1(){
              viewer.zoomTo(pc_demo1); // zoom to the tileset
            };

            function zoompc2(){
              viewer.zoomTo(pc_demo2); // zoom to the tileset
            };

            function zoompc3(){
              viewer.zoomTo(pc_demo3); // zoom to the tileset
            };

            function zoomortho1(){
              viewer.zoomTo(ortho_demo1); // zoom to the tileset
            };

			this.viewer.scene.fxaa = false;// 


            // Modifying home button position
            viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function (e) {
                e.cancel = true;
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(9.398960475752261,
                        48.529346010903474,
                        6631.082799425431),
                })
            })
		
	
	//show (rough) height/latitude/longitude
            show3DCoordinates()
            function show3DCoordinates(){
              var coordinatesDiv = document.getElementById("map_coordinates");
              if (coordinatesDiv){
                coordinatesDiv.style.display = "block";
              }
              else{
                coordinatesDiv = document.createElement("div");
                coordinatesDiv.id = "map_coordinates";
                coordinatesDiv.style.zIndex = "50";
                coordinatesDiv.style.bottom = "1px";
                coordinatesDiv.style.height = "29px";
                coordinatesDiv.style.position = "absolute";
                coordinatesDiv.style.overflow = "hidden";
                coordinatesDiv.style.textAlign = "center";
                coordinatesDiv.style.padding = "0 10px";
                coordinatesDiv.style.background = "rgba(0,0,0,0.5)";
                coordinatesDiv.style.left = "0";
                coordinatesDiv.style.bottom = "0";
                coordinatesDiv.style.lineHeight = "29px";
                coordinatesDiv.innerHTML = "<span id='cd_label' style='font-size:13px;text-align:center;font-family:sans-serif;color:#edffff;'>no coordinate information</span>";
                document.getElementById("cesiumContainer").append(coordinatesDiv);
                var handler3D = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
                handler3D.setInputAction(function(movement){
                  var pick = new Cesium.Cartesian2(movement.endPosition.x,movement.endPosition.y);
                  if(pick){
                    var cartesian = viewer.scene.globe.pick(viewer.camera.getPickRay(pick),viewer.scene);
                    if (cartesian){
                      //convert coordinate
                      var cartographic = viewer.scene.globe.ellipsoid.cartesianToCartographic(cartesian);
                      if (cartographic){
                        //altitude
                        var height = viewer.scene.globe.getHeight(cartographic);
                        //viewer height
                        var he = Math.sqrt(viewer.scene.camera.positionWC.x * viewer.scene.camera.positionWC.x + viewer.scene.camera.positionWC.y * viewer.scene.camera.positionWC.y + viewer.scene.camera.positionWC.z * viewer.scene.camera.positionWC.z);
                        var he2 = Math.sqrt(cartesian.x * cartesian.x + cartesian.y * cartesian.y + cartesian.z * cartesian.z);
                        //geographic coordinate to latitude/longitude
                        var point = [cartographic.longitude / Math.PI * 180, cartographic.latitude / Math.PI * 180];
                        if (!height) {
                          height = 0;
                        }
                        if (!he) {
                          he = 0;
                        }
                        if (!he2) {
                          he2 = 0;
                        }
                        if (!point) {
                          point = [0, 0];
                        }
                        coordinatesDiv.innerHTML = "<span id='cd_label' style='font-size:13px;text-align:center;font-family:sans-serif;color:#edffff;'>Viewing Height:" + (he - he2).toFixed(2) + "m&nbsp;&nbsp;&nbsp;&nbsp;Altitude:" + height.toFixed(2) + "m&nbsp;&nbsp;&nbsp;&nbsp;longitude: " + point[0].toFixed(6) + "&nbsp;&nbsp;latitude：" + point[1].toFixed(6) + "</span>";
                      }
                    }
                  }
                },Cesium.ScreenSpaceEventType.MOUSE_MOVE);
              }
            }




        </script>
    </article>
</section>

    <footer>
      <p>This Website was created by WP8 in intergrated fieldwork 2022 conducted at the University of Stuttgart.</p>
    </footer>     
</body>
</html>
