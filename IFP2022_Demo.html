<!DOCTYPE html>
<html lang="en">

<head>
<!-- text of browser's title/tab -->
<title>Intergrated fieldwork Demo</title>
<!-- icon displayed in the address bar -->
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Include the CesiumJS JavaScript and CSS files -->
<script src="https://cesium.com/downloads/cesiumjs/releases/1.78/Build/Cesium/Cesium.js"></script>
<link href="https://cesium.com/downloads/cesiumjs/releases/1.78/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- design of the website -->
<!-- CSS used here -->
<style>
/* Activation of Visual tools in Cesium */
@import url(./Cesium/Widgets/widgets.css)

*{
  box-sizing: border-box;
}

body {
  font-family: Arial, Helvetica, sans-serif;
  background-image: url("img_2022/bg.png");
  background-color: black;
}

/* Style the header */
header { 
  background-color: rgba(255, 255, 255, 0);
  height: 100px;
  padding: 5px;
  text-align: center;
  font-size: 20px;
  color: rgb(255, 255, 255);
  animation: slideInFromTop .5s ease-in;
}

h1 {
    font-family: monospace;
}

.neonText {
    color: #fff;
    text-shadow:
      0 0 7px rgb(17, 2, 2),
      0 0 15px rgb(249, 255, 255);
  }
  .pulsate {
     animation: pulsate 1.5s infinite alternate;     
}

article {
  float: left;
  padding: 0px;
  width: 78%;
  background-color: rgb(204, 204, 204);
}

nav {
  float: right;
  width: 19%;
  background-image: url("img_2022/bg.png"); 
  background: #24cfe68a;
  padding: 20px;
  display: inline-block;
  animation: slideInFromLeft .7s ease-in;
}

/* Clear floats after the columns */
section::after {
  content: "";
  display: table;
  clear: both;
}

/* Style: button */
.button{
  background-color: white;
  border-radius: 5px;
  border: 1.5px solid #000;
  box-shadow: 0 5px 12px 0 rgba(0,0,0,0.3), 0 6px 20px 0 rgba(0,0,0,0.25);
  color: black;
  height: 18px;
  position: absolute;
  font-size: 14px;
  line-height: 0.7;
}

.button:hover{
  background-color: #ccc;
  letter-spacing: 0.20em;
  transition: 0.5s;
}

.button:active{
  background-color: white;
  transform: translateY(2px);
}

.button:focus{
  background-color: #706e6e;
  cursor: wait;
}

.button:visited{
  background-color: #706e6e;
}

/* Style: checkbox */
input[type="checkbox"] {
  position: absolute;
  left: -20px;
}

input[type="checkbox"] + label {
  position: relative;
  display: inline-flex;
  cursor: pointer;
  font-family: sans-serif;
  font-size: 16px;
  line-height: 1.3;
}

input[type="checkbox"] + label:before {
  width: 35px;
  height: 13px;
  border-radius: 30px;
  border: 2px solid #ddd;
  background-color: #EEE;
  content: "";
  margin-right: 10px;
  transition: background-color 0.5s linear;
}

input[type="checkbox"] + label:after {
  width: 13px;
  height: 13px;
  border-radius: 30px;
  background-color: #fff;
  content: "";
  transition: margin 0.1s linear;
  box-shadow: 0px 0px 5px #aaa;
  position: absolute;
  left: 3px;
  top: 3px;
}

input[type="checkbox"]:checked + label:before {
  background-color: rgb(247, 163, 68);
}

input[type="checkbox"]:checked + label:after {
  margin: 0 0 0 22px;
  background-color: rgb(255, 255, 255);
}

/* Scrollbar
/* width */
::-webkit-scrollbar {
  width: 11px;
}

/* Track */
::-webkit-scrollbar-track {
  box-shadow: inset 0 0 5px rgb(18, 14, 44);
  border-radius: 10px;
}

/* Handle */
::-webkit-scrollbar-thumb {
  background: rgb(196, 192, 192);
  border-radius: 10px;
}

/* Style the footer */
footer {
  background-color: rgb(34, 30, 30);
  background-image: url("img_2022/bg.png"); 
  padding: 10px;
  text-align: center;
  color: white;
  border-radius: 0%;
  border-color: white;
  animation: slideInFromBottom 1s ease-in;
}

/* Footers Background & colored buttons */
.bg-dark,
.btn-dark {
  background-color: var(--dark-color);
  color: #fff;
}

.bg-dark a,
.btn-dark a {
  color: #fff;
}

.footer .social a {
  margin: 0 10px;
}

.fa-github:hover {
  color: #6b0799;
}

.fa-facebook:hover {
  color: #1773EA;
}

.fa-instagram:hover {
  color: #B32E87;
}

.fa-twitter:hover {
  color: #1C9CEA;
}

.fa-building-columns:hover {
  color: #17dbe9;
}

/* Animations */
@keyframes slideInFromLeft {
  0% {
    transform: translateX(-100%);
  }

  100% {
    transform: translateX(0);
  }
}

@keyframes slideInFromRight {
  0% {
    transform: translateX(100%);
  }

  100% {
    transform: translateX(0);
  }
}

@keyframes slideInFromTop {
  0% {
    transform: translateY(-100%);
  }

  100% {
    transform: translateX(0);
  }
}

@keyframes slideInFromBottom {
  0% {
    transform: translateY(100%);
  }

  100% {
    transform: translateX(0);
  }
}
</style>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script type="text/javascript" src="LineFlowMaterialProperty.js"></script>
<script type="text/javascript" src="TrailLineMaterialProperty.js"></script>
</head>



<!-- main content of the website -->
<body>
    <header>
      <h1 class="neonText pulsate"> Visualization of Hülben aerodrome <br> </h1>
    </header>

<section>
    <!-- checkboxes/buttons -->
    <nav>
        <b>3D Point Clouds</b>
        <br>
        <br>
          <input type="checkbox" id="pc1_button" onclick="Check_PC1()" checked="true"> <label for="pc1_button"> Demo for Uni Stuttgart </label>
          <button class="button" id="zoom_pc1" style="position: absolute; right: 20px;" onclick="zoompc1()" > Zoom </button>
        <br>
        <br>
          <input type="checkbox" id="pc2_button" onclick="Check_PC2()" > <label for="pc2_button"> Demo indoor </label>
          <button class="button" id="zoom_pc2" style="position: absolute; right: 20px;" onclick="zoompc2()" > Zoom </button>
        <br>
        <br>
          <input type="checkbox" id="pc3_button" onclick="Check_PC3()"> <label for="pc3_button"> Demo playgronud </label>
          <button class="button" id="zoom_pc3" style="position: absolute; right: 20px;" onclick="zoompc3()" > Zoom </button>
        <br>
        <br>
        <br>
          <b>Orthophotos</b>
        <br>
        <br>
          <input type="checkbox" id="ortho1_button" onclick="Check_OP1()" > <label for="ortho1_button"> Airport brief</label>
          <button class="button" id="zoom_ortho1" style="position: absolute; right: 20px;" onclick="zoomortho1()" > Zoom </button>
        <br>
	<br>
          <input type="checkbox" id="ortho2_button" onclick="Check_OP2()" > <label for="ortho2_button"> Airport brief</label>
          <button class="button" id="zoom_ortho2" style="position: absolute; right: 20px;" onclick="zoomortho2()" > Zoom </button>
      	<br>
        <br>
          <b>Polygon</b>
        <br>
        <br>
          <input type="checkbox" id="Runway_button" onclick="Check_RW()" > <label for="Runway_button"> Anflugblatt </label>
          <button class="button" id="zoom_Runway" style="position: absolute; right: 20px;" onclick="zoomRunway()" > Zoom </button>
        <br>      
        <br>
        <br>
        <b>NOTE: </b>Loading the trajectories takes a few moments.
      <br>
      <br>
    </nav>


    <!-- Cesium Viewer -->
    <article>
        <div id="cesiumContainer" style="width: 100%; height:600px"></div>
    
        <script>
            //default access token from my ion account
            Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxMjJlMDA0Zi01MjczLTQ3MjAtYTEyYS1mNWY3NjI0NDgxMzYiLCJpZCI6OTQzNTgsImlhdCI6MTY1MjkwMDIxN30.Irz7lx9hf8nDgJtHCD_2XXzNOY2giijRxZdNqLjD7HU';

            // Initialize the Cesium Viewer in the HTML element with the `cesiumContainer` ID.
            var viewer = new Cesium.Viewer('cesiumContainer', {
                geocoder: true,                
                sceneModePicker: true,         
                navigationHelpButton: true,    
                baseLayerPicker: true,         
                homeButton: true,            
                fullscreenButton: true,         
                timeline: true,                 
                animation: true,               
              terrainProvider: new Cesium.CesiumTerrainProvider({
                  url: Cesium.IonResource.fromAssetId(1),
              }),
              // terrainProvider: new Cesium.CesiumTerrainProvider({
              //   url: Cesium.IonResource.fromAssetId(1121911),
              // }),//load local terrain --- ???need to be corrected
              imageryProvider: Cesium.createWorldImagery({
                style: Cesium.IonWorldImageryStyle.AERIAL
              })


            });
             // Load Cesium World Terrain
            viewer.terrainProvider = Cesium.createWorldTerrain({
              requestWaterMask : true, // required for water effects
              requestVertexNormals : true // required for terrain lighting
            });
             // Enable depth testing so things behind the terrain disappear.
            viewer.scene.globe.depthTestAgainstTerrain = false;

			
            //add point cloud
            var pc_demo1 = viewer.scene.primitives.add(
              new Cesium.Cesium3DTileset({
                url: Cesium.IonResource.fromAssetId(1056684),
              })
            );

            var pc_demo2 = viewer.scene.primitives.add(
              new Cesium.Cesium3DTileset({
                url: Cesium.IonResource.fromAssetId(1113299),
              })
            );

            var pc_demo3 = viewer.scene.primitives.add(
              new Cesium.Cesium3DTileset({
                url: Cesium.IonResource.fromAssetId(1113301),
              })
            );


            //add orthophotos
            var ortho_demo1 = viewer.imageryLayers.addImageryProvider(
              new Cesium.IonImageryProvider({ assetId: 1113345 })
            );
	
	    var ortho_demo2 = viewer.imageryLayers.addImageryProvider(
              new Cesium.IonImageryProvider({ assetId: 1174258 })
            );

            // Load KML files
            var Markings_Fixed_Point = Cesium.IonResource.fromAssetId(1137102).then(function (resource) {
                var options = {
                    camera: viewer.scene.camera,
                    canvas: viewer.scene.canvas
                };
                viewer.dataSources.add(Cesium.KmlDataSource.load(resource, options));
            });
            
            // Add Geojsons 
            Cesium.GeoJsonDataSource.clampToGround = true;

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Avoid_Urban_Area.geojson', {
            stroke: Cesium.Color.HOTPINK,
            fill: Cesium.Color.PINK.withAlpha(0.5),
            strokeWidth: 800
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Avoid_Traffic.geojson', {
            stroke: Cesium.Color.HOTPINK,
            fill: Cesium.Color.PINK.withAlpha(0.5),
            strokeWidth: 800
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Landing_Area_1.geojson', {
            stroke: Cesium.Color.DARKGREEN,
            fill: Cesium.Color.CHARTREUSE.withAlpha(0.5),
            strokeWidth: 400
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Landing_Area_2.geojson', {
            stroke: Cesium.Color.DARKGREEN,
            fill: Cesium.Color.CHARTREUSE.withAlpha(0.5),
            strokeWidth: 400
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Go_Around_Course_1.geojson', {
            stroke: Cesium.Color.YELLOW,
            fill: Cesium.Color.YELLOW.withAlpha(0.0),
            strokeWidth: 400
            }));

            viewer.dataSources.add(Cesium.GeoJsonDataSource.load('GEO_json_2022/Go_Around_Course_2.geojson', {
            stroke: Cesium.Color.YELLOW,
            fill: Cesium.Color.YELLOW.withAlpha(0.0),
            strokeWidth: 400
            }));

            // Adding Billboards
            var enetity = viewer.entities.add({
                name: 'Icon',
                position: Cesium.Cartesian3.fromDegrees(9.39703519151607, 48.529622848194435,1000),
                billboard: {
                    image: 'img_2022/Test_Icon.png',
                    horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    width: 20, // default: undefined
                    height: 20, // default: undefined
                    scale: 1,
                }
            })
    


            //draw line
            var Segelflug = viewer.entities.add({
              name: "Segelflug - 2970ft/900m",
              wall :{
                positions : Cesium.Cartesian3.fromDegreesArray(
                  [9.39703519151607,48.529622848194435, 
                   9.386956349001773,48.530292490420834,
                   9.388908997194635,48.53648757756843,
                   9.407899037160616,48.53512358676029,
                   9.406954502423504,48.528754432235466,
                   9.402340033389647,48.529216576652004]),
                maximumHeights: [900,900,900,900,900,900],
                minumumHeights: [0,0,0,0,0,0],
                material: Cesium.Color.BLUE.withAlpha(0.5),
              },
            });

            var Motorflug = viewer.entities.add({
              name: "Motorflug - 3200ft/975m",
              wall :{
                positions : Cesium.Cartesian3.fromDegreesArray(
                  [9.39703519151607,48.529622848194435, 
                   9.37824396517381,48.53135453585247, 
                   9.379830468769919,48.54176894670979,
                   9.42008506241363,48.538955968904105,
                   9.418325533250623, 48.52821407020955,
                   9.402340033389647,48.529216576652004]),
                maximumHeights: [975,975,975,975,975,975],
                minumumHeights: [0,0,0,0,0,0],
                material: Cesium.Color.BLUE.withAlpha(0.5),
              },
            });
             
  

            //Setting material for the dynamic wall
            function DynamicWallMaterialProperty(options) {
                this._definitionChanged = new Cesium.Event();
                this._color = undefined;
                this._colorSubscription = undefined;
                this.color = options.color;
                this.duration = options.duration;
                this.trailImage = options.trailImage;
                this._time = (new Date()).getTime();
            }
            Object.defineProperties(DynamicWallMaterialProperty.prototype, {
                isConstant: {
                    get: function() {
                        return false;
                    }
                },
                definitionChanged: {
                    get: function() {
                        return this._definitionChanged;
                    }
                },
                color: Cesium.createPropertyDescriptor('color')
            });
            DynamicWallMaterialProperty.prototype.getType = function(time) {
                return 'DynamicWall';
            };
            DynamicWallMaterialProperty.prototype.getValue = function(time, result) {
                if (!Cesium.defined(result)) {
                    result = {};
                }
                result.color = Cesium.Property.getValueOrClonedDefault(this._color, time, Cesium.Color.WHITE, result.color);
                if (this.trailImage) {
                    result.image = this.trailImage;
                } else {
                    result.image = Cesium.Material.DynamicWallImage
                }

                if (this.duration) {
                    result.time = (((new Date()).getTime() - this._time) % this.duration) / this.duration;
                }
                viewer.scene.requestRender();
                return result;
            };
            DynamicWallMaterialProperty.prototype.equals = function(other) {
                return this === other ||
                    (other instanceof DynamicWallMaterialProperty &&
                        Cesium.Property.equals(this._color, other._color))
            };
            Cesium.DynamicWallMaterialProperty = DynamicWallMaterialProperty;
            Cesium.Material.DynamicWallType = 'DynamicWall';
            Cesium.Material.DynamicWallImage = "img/colors.png";
            Cesium.Material.DynamicWallSource = "czm_material czm_getMaterial(czm_materialInput materialInput)\n\
                                                        {\n\
                                                        czm_material material = czm_getDefaultMaterial(materialInput);\n\
                                                        vec2 st = materialInput.st;\n\
                                                        vec4 colorImage = texture2D(image, vec2(fract(st.t - time), st.t));\n\
                                                        vec4 fragColor;\n\
                                                        fragColor.rgb = color.rgb / 1.0;\n\
                                                        fragColor = czm_gammaCorrect(fragColor);\n\
                                                        material.alpha = colorImage.a * color.a;\n\
                                                        material.diffuse = color.rgb;\n\
                                                        material.emission = fragColor.rgb;\n\
                                                        return material;\n\
                                                        }";
            Cesium.Material._materialCache.addMaterial(Cesium.Material.DynamicWallType, {
                fabric: {
                    type: Cesium.Material.DynamicWallType,
                    uniforms: {
                        color: new Cesium.Color(1.0, 1.0, 1.0, 1),
                        image: Cesium.Material.DynamicWallImage,
                        time: 0
                    },
                    source: Cesium.Material.DynamicWallSource
                },
                translucent: function(material) {
                    return true;
                }
            });



            // Setting area and adding dynamic wall

              function drawWall(viewer, positions) {
                  // draw wall
                  this.viewer.entities.add({
                      name: "3D Wall effect",
                      wall: {
                          positions: positions,
                          // set height
                          maximumHeights: new Array(positions.length).fill(100),
                          minimunHeights: new Array(positions.length).fill(0),
                          material: new Cesium.DynamicWallMaterialProperty({
                              color: Cesium.Color.fromBytes(55, 96, 56).withAlpha(0.7),
                              duration: 3000
                          }),
                      }
                  })
              }

            
            //function for checkbox buttom
            function Check_PC1(){
              //Show/hide point cloud for demo
              if (document.getElementById('pc1_button').checked == true) { //if the buttons is checked
                pc_demo1.show = true;// make the point cloud visible
              }
              else {
                pc_demo1.show = false;// close the point cloud
              }
            }

            function Check_PC2(){
              //Show/hide point cloud for demo
              if (document.getElementById('pc2_button').checked == true) { //if the buttons is checked
                pc_demo2.show = true;// make the point cloud visible
              }
              else {
                pc_demo2.show = false;// close the point cloud
              }
            }

            function Check_PC3(){
              //Show/hide point cloud for demo
              if (document.getElementById('pc3_button').checked == true) { //if the buttons is checked
                pc_demo3.show = true;// make the point cloud visible
              }
              else {
                pc_demo3.show = false;// close the point cloud
              }
            }

            function Check_OP1(){
              //Show/hide point cloud for demo
              if (document.getElementById('ortho1_button').checked == true) { //if the buttons is checked
                ortho_demo1.show = true;// make the point cloud visible
              }
              else {
                ortho_demo1.show = false;// close the point cloud
              }
            }
	
	    function Check_OP2(){
              //Show/hide point cloud for demo
              if (document.getElementById('ortho2_button').checked == true) { //if the buttons is checked
                ortho_demo2.show = true;// make the point cloud visible
              }
              else {
                ortho_demo2.show = false;// close the point cloud
              }
            }



            //function for zoom buttom
            function zoompc1(){
              viewer.zoomTo(pc_demo1); // zoom to the tileset
            };

            function zoompc2(){
              viewer.zoomTo(pc_demo2); // zoom to the tileset
            };

            function zoompc3(){
              viewer.zoomTo(pc_demo3); // zoom to the tileset
            };

            function zoomortho1(){
              viewer.zoomTo(ortho_demo1); // zoom to the tileset
            };
		
	    function zoomortho2(){
              viewer.zoomTo(ortho_demo2); // zoom to the tileset
            };

			this.viewer.scene.fxaa = false;// 


            // Modifying home button position
            viewer.homeButton.viewModel.command.beforeExecute.addEventListener(function (e) {
                e.cancel = true;
                viewer.camera.flyTo({
                    destination: Cesium.Cartesian3.fromDegrees(9.398960475752261,
                        48.529346010903474,
                        6631.082799425431),
                })
            })
		
	
	//show (rough) height/latitude/longitude
            show3DCoordinates()
            function show3DCoordinates(){
              var coordinatesDiv = document.getElementById("map_coordinates");
              if (coordinatesDiv){
                coordinatesDiv.style.display = "block";
              }
              else{
                coordinatesDiv = document.createElement("div");
                coordinatesDiv.id = "map_coordinates";
                coordinatesDiv.style.zIndex = "50";
                coordinatesDiv.style.bottom = "1px";
                coordinatesDiv.style.height = "29px";
                coordinatesDiv.style.position = "absolute";
                coordinatesDiv.style.overflow = "hidden";
                coordinatesDiv.style.textAlign = "center";
                coordinatesDiv.style.padding = "0 10px";
                coordinatesDiv.style.background = "rgba(0,0,0,0.5)";
                coordinatesDiv.style.left = "0";
                coordinatesDiv.style.bottom = "0";
                coordinatesDiv.style.lineHeight = "29px";
                coordinatesDiv.innerHTML = "<span id='cd_label' style='font-size:13px;text-align:center;font-family:sans-serif;color:#edffff;'>no coordinate information</span>";
                document.getElementById("cesiumContainer").append(coordinatesDiv);
                var handler3D = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
                handler3D.setInputAction(function(movement){
                  var pick = new Cesium.Cartesian2(movement.endPosition.x,movement.endPosition.y);
                  if(pick){
                    var cartesian = viewer.scene.globe.pick(viewer.camera.getPickRay(pick),viewer.scene);
                    if (cartesian){
                      //convert coordinate
                      var cartographic = viewer.scene.globe.ellipsoid.cartesianToCartographic(cartesian);
                      if (cartographic){
                        //altitude
                        var height = viewer.scene.globe.getHeight(cartographic);
                        //viewer height
                        var he = Math.sqrt(viewer.scene.camera.positionWC.x * viewer.scene.camera.positionWC.x + viewer.scene.camera.positionWC.y * viewer.scene.camera.positionWC.y + viewer.scene.camera.positionWC.z * viewer.scene.camera.positionWC.z);
                        var he2 = Math.sqrt(cartesian.x * cartesian.x + cartesian.y * cartesian.y + cartesian.z * cartesian.z);
                        //geographic coordinate to latitude/longitude
                        var point = [cartographic.longitude / Math.PI * 180, cartographic.latitude / Math.PI * 180];
                        if (!height) {
                          height = 0;
                        }
                        if (!he) {
                          he = 0;
                        }
                        if (!he2) {
                          he2 = 0;
                        }
                        if (!point) {
                          point = [0, 0];
                        }
                        coordinatesDiv.innerHTML = "<span id='cd_label' style='font-size:13px;text-align:center;font-family:sans-serif;color:#edffff;'>Viewing Height:" + (he - he2).toFixed(2) + "m&nbsp;&nbsp;&nbsp;&nbsp;Altitude:" + height.toFixed(2) + "m&nbsp;&nbsp;&nbsp;&nbsp;longitude: " + point[0].toFixed(6) + "&nbsp;&nbsp;latitude：" + point[1].toFixed(6) + "</span>";
                      }
                    }
                  }
                },Cesium.ScreenSpaceEventType.MOUSE_MOVE);
              }
            }
	
	//draw lines to show flight track
	parabolaFlowInit(this.viewer, 3);
          function parabolaFlowInit(_viewer, _num){
            let _center = [9.399834579856272,48.52943931087477,765];
            let _positions = [
              [8.56375013822731, 50.044386848497496],
              [9.202077639605864, 48.68900657866884],
              [10.232940728020417, 47.987767549496205],
              [9.514466803475603, 47.670568938082155],
              [8.085880815840014, 48.77783117629837],
              [2.5478380129637888, 49.00739452183982],
              [8.555021094646033, 47.46077096457037],
              [13.512891102041024, 52.364369726843485]
            ];
            _positions.forEach(item =>{
              let _singlePositions = parabola(_center, item, 5000);
              //create flowing line
              for (let i = 0; i<_num; i++){
                _viewer.entities.add({
                  polyline:{
                    positions: _singlePositions,
                    material: new Cesium.LineFlowMaterialProperty({
                      color: new Cesium.Color(1.0, 1.0, 0.0, 0.8),
                      speed: 15 * Math.random(),
                      percent: 0.3,
                      gradient: 0.01
                    })
                  },
                });
              }
              //create trace line
              _viewer.entities.add({
                polyline:{
                  positions: _singlePositions,
                  material: new Cesium.Color(1.0, 1.0, 0.0, 0.2),
                }
              })
            });

            //parabola constructor
            function parabola(
              startPosition,
              endPosition,
              height = 0,
              count = 50
            ){
              //equation y = -(4h/L^2)*x^2+h h:vertex height L:larger one of horizontal&vertical distance
              let result = []
              height = Math.max(+height,100)
              count = Math.max(+count, 50)
              let diffLon = Math.abs(startPosition[0] - endPosition[0])
              let diffLat = Math.abs(startPosition[1] - endPosition[1])
              let L = Math.max(diffLon,diffLat)
              let dlt = L/count
              if(diffLon>diffLat){
                //base on lon
                let delLat = (endPosition[1]-startPosition[1]) / count
                if (startPosition[0] - endPosition[0] > 0){
                  dlt = -dlt
                }
                for(let i=0; i<count; i++){
                  let h = 
                      height - 
                      (Math.pow(-0.5 * L + Math.abs(dlt) * i,2) * 4 * height) /
                      Math.pow(L,2) + startPosition[2]
                  let lon = startPosition[0] + dlt * i
                  let lat = startPosition[1] + delLat * i
                  let point = new Cesium.Cartesian3.fromDegrees(lon, lat, h);
                  result.push(point);
                }
              }else{
                //base on Lat
                let delLon = (endPosition[0] - startPosition[0]) / count
                if (startPosition[1] - endPosition[1] >0){
                  dlt = -dlt
                }
                for(let i = 0; i<count; i++){
                  let h =
                      height - 
                      (Math.pow(-0.5 * L + Math.abs(dlt) * i,2) * 4 * height) /
                      Math.pow(L,2)+ startPosition[2]
                  let lon = startPosition[0] + delLon * i
                  let lat = startPosition[1] + dlt * i
                  let point = new Cesium.Cartesian3.fromDegrees(lon, lat, h);
                  result.push(point);
                }
              }
              return result
            }
          }
	
		
	//show motorflug and segelflug
          //wall effect with moving around arrows
          $.get('GEO_json_2022/Go_Around_Course_1_r.geojson', function(data) {
            for (let i = 0; i < data.features[0].geometry.coordinates.length; i++) {
              SegelFlugPosition = data.features[0].geometry.coordinates[i].toString().split(',');
            }
            viewer.entities.add({
              name: "SegelFlug-2970ft/900m",
              wall: {
                positions: Cesium.Cartesian3.fromDegreesArray(SegelFlugPosition),
                // set height
                maximumHeights: new Array(SegelFlugPosition.length).fill(970),
                minimumHeights: new Array(SegelFlugPosition.length).fill(900),
                material: new Cesium.TrailLineMaterialProperty({
                  color: Cesium.Color.BLUE,
                  duration: 18000,
                })
              }
            })
          })

          $.get('GEO_json_2022/Go_Around_Course_2_r.geojson', function(data) {
            for (let i = 0; i < data.features[0].geometry.coordinates.length; i++) {
              MotorFlugPosition = data.features[0].geometry.coordinates[i].toString().split(',');
            }
            viewer.entities.add({
              name: "MotorFlug-3200ft/975m",
              wall: {
                positions: Cesium.Cartesian3.fromDegreesArray(MotorFlugPosition),
                // set height
                maximumHeights: new Array(MotorFlugPosition.length).fill(1045),
                minimumHeights: new Array(MotorFlugPosition.length).fill(975),
                material: new Cesium.TrailLineMaterialProperty({
                  color: Cesium.Color.BLUE,
                  duration: 18000,
                })
              }
            })
          })




        </script>
    </article>
</section>

<footer class="footer bg-dark py-5">
  <div class="container grid grid-3">
    <div>
      <h2></h2>
    </div>
    <div class="social">
        <a href="https://www.ifp.uni-stuttgart.de/en/"><i class="fas fa-building-columns fa-2x"></i></a>
        <a href="#"><i class="fab fa-github fa-2x"></i></a>
        <a href="https://www.facebook.com/Universitaet.Stuttgart"><i class="fab fa-facebook fa-2x"></i></a>
        <a href="https://www.instagram.com/unistuttgart/"><i class="fab fa-instagram fa-2x"></i></a>
        <a href="https://twitter.com/Uni_Stuttgart"><i class="fab fa-twitter fa-2x"></i></a>
    </div>
  </div>
  <h5>created by WP8 at the University of Stuttgart &copy; 2022</h5>
</footer>     
</body>
</html>
